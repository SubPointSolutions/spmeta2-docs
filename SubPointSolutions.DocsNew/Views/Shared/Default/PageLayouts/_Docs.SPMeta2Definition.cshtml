@using System;
@using System.Linq;
@using System.Collections;
@using System.Collections.Generic;

@{
    Layout = SConfig.GetThemedTemplate("Layouts/_Main.Master.cshtml");
}

<header class="header header-content" id="top" data-stellar-background-ratio="0.5">
    @{
        try
        {
            @Html.Partial(SConfig.GetThemedTemplate("Components/_Override.TopNavigation.cshtml"));
        }
        catch
        {
            @Html.Partial(SConfig.GetThemedTemplate("Components/_Main.TopNavigation.cshtml"));
        }
    }

</header>

<style>
    section {
        padding-top: 60px;
        margin-top: -60px;
    }

    @@media only screen and (max-width : 768px) {
        section {
            padding-top: 120px;
            margin-top: -120px;
        }
    }
</style>

<div class="container body-content sd-body-content sd-definition-content">

    <div class="row sps-secondnav">
        @Html.Partial(SConfig.GetThemedTemplate("Components/_Docs.SecondNavigation.cshtml"))
    </div>

    <div class="row">

        <div class="col-lg-3 col-md-3 col-sm-3 sps-sidebar">
            @Html.Partial(SConfig.GetThemedTemplate("Components/_Docs.Sidebar.cshtml"))
        </div>

        <div class="col-lg-9 col-md-9 col-sm-9 sps-document">

            @{
                var isHidden = Model.Get<bool>("Hidden");

                var csomLabel = "label-default";
                var ssomLabel = "label-default";

                var scopes = new List<string>();
                var samples = new List<SubPointSolutions.DocsBuildTools.Data.DocSample>();

                var fileName = Model.String("SourceFileBase");
                var definitionName = Model.String("SourceFileBase").Replace("Tests", string.Empty);

                if (isHidden == false)
                {
                    samples = SConfig.AllSamples
                                     .Where(s => s.IsMethod && s.ClassName == (definitionName + "Tests"))
                                     .ToList();

                    var supportsCSOMValue = Model.Get("spmeta2.isCSOMCompatible");
                    var supportsSSOMValue = Model.Get("spmeta2.isSSOMCompatible");
                    var scopesValue = Model.Get("spmeta2.parentHostTypes");

                    if (supportsCSOMValue == null)
                    {
                        throw new Exception(String.Format("Cannot find metadata value [{0}] for file:[{1}]", "spmeta2.isCSOMCompatible", fileName));
                    }

                    if (supportsSSOMValue == null)
                    {
                        throw new Exception(String.Format("Cannot find metadata value [{0}] for file:[{1}]", "spmeta2.isSSOMCompatible", fileName));
                    }

                    if (scopesValue == null)
                    {
                        throw new Exception(String.Format("Cannot find metadata value [{0}] for file:[{1}]", "spmeta2.parentHostTypes", fileName));
                    }

                    csomLabel = Boolean.Parse((string)supportsCSOMValue) ? "label-success" : "label-default";
                    ssomLabel = Boolean.Parse((string)supportsSSOMValue) ? "label-success" : "label-default";

                    scopes = ((string)scopesValue).Split(',').Select(s => s.Trim().Replace("Definition", String.Empty)).ToList();
                }
            }

            <div class="api-page-header-cnt">
                <div class="pull-right tool-api-cnt">

                    <span class="tool-api-label">Scope:</span>

                    @foreach (var scope in scopes)
                    {
                        <span class="label label-success">@scope</span>
                    }

                    <span class="tool-api-label">API:</span>
                    <span class="label @csomLabel">CSOM</span>
                    <span class="label @ssomLabel">SSOM</span>
                </div>
                <h4>@definitionName</h4>
            </div>

            @{
                var body = RenderBody();
            }

            @if (body != null)
            {
                this.WriteTo(Output, body);
            }
            else
            {
                <div class="well well-lg">
                    <h2>Ouch...</h2>
                    <p>Nothing much to note</p>
                    <p>
                        Let us know if more documentation is needed ay <a href='https://www.yammer.com/spmeta2feedback/'>Yammer Community</a>
                        or put a few words together at <span><a href='https://github.com/SubPointSolutions' target="_blank">github</a></span>.
                        We'll help you out.
                    </p>
                </div>
            }

            <h4>Example Usage</h4>



            @if (samples.Any())
            {
                <div class="example-toc-links-cnt">
                    <ul>
                        @foreach (var sample in samples)
                        {
                            if (String.IsNullOrEmpty(sample.Title))
                            {
                                throw new Exception(String.Format("Sample with method name [{0}] does not have title. FileName:[{1}]", sample.MethodName, sample.SourceFileName));
                            }

                            <li><a href="@("#" + SubPointSolutions.DocsBuildTools.Data.SampleReadAPI.GetSafeAnchor(sample.Title))">@sample.Title</a></li>
                        }
                    </ul>
                </div>

                <div class="m-sample-list-cnt">

                    @foreach (var sample in samples)
                    {
                        <section name="@(SubPointSolutions.DocsBuildTools.Data.SampleReadAPI.GetSafeAnchor(sample.Title))" id="@(SubPointSolutions.DocsBuildTools.Data.SampleReadAPI.GetSafeAnchor(sample.Title))"></section>

                        <table class='table table-bordered'>


                            <tr>
                                <td>
                                    @if (isHidden)
                                    {
                                        @(sample.Title)
                                    }
                                    else
                                    {
                                        @*<a href="@(definitionPageUrl + "?#" + SubPointSolutions.DocsBuildTools.Data.SampleReadAPI.GetSafeAnchor(sample.Title))">
                                                @(sample.Title)
                                            </a>*@

                                        <a href="javascript:void();">
                                            @(sample.Title)
                                        </a>
                                    }
                                </td>
                                <td>
                                    This is a description for super example: @(sample.Title) @(sample.Description)
                                </td>

                            </tr>
                            <tr>
                                <td colspan="2" style="padding:0">
                                    <div class="docs-source-cnt" style="margin-top:0">

                                        <div class="">

                                            <div class="docs-source-tool-panel-cnt">
                                                <div class="pull-right docs-source-tool-subpanel-cnt">
                                                    <a target="_blank" href="https://www.yammer.com/spmeta2feedback/">Ask on Yammer</a>
                                                </div>
                                            </div>

                                            <pre><code class="language-cs brush: csharp">@sample.MethodBody</code></pre>
                                        </div>
                                    </div>
                                </td>
                            </tr>
                        </table>
                    }

                </div>
            }
            else
            {
                <div class="well well-lg">
                    <h2>Ouch...</h2>
                    <p>Seems there are't much samples yet.</p>
                    <p>
                        Drop us a line at <a href='#'>Yammer</a> or put a few words together at <span><a href='#' target="_blank">github</a></span>.
                        We'll help you out.
                    </p>
                </div>
            }
        </div>


    </div>
</div>
