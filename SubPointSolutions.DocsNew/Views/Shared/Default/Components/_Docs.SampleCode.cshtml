@{
    var categoryTagName = "Category";

    var allSamples = SConfig.AllSamples.Where(s => s.IsMethod).ToList();

    var allCategories = new List<string>();

    var customCategory = Model.Get<string>("SampleCategory");
    
    //allCategories.Add("Farm Model");

    if (!string.IsNullOrEmpty(customCategory))
    {
        allCategories.Add(customCategory);
    }

    //allCategories.Add("Web Application Model");
    //allCategories.Add("Site Collection Model");
    //allCategories.Add("Web Model");

    var samplesWithCategories = SubPointSolutions.DocsBuildTools.Data.SampleReadAPI.GetSamplesWithTag(allSamples, categoryTagName);


    var sampleCategories = allCategories
                             // initial sorting by name
                             //.OrderBy(m => m)
                             // sorting by any category attr
                             //.OrderBy(m => allSamples.FirstOrDefault(
                             //    // has both category and order
                             //                                   s => samplesAPI.HasTag(s, categoryOrderTagName)
                             //                                        && samplesAPI.HasTagValue(s, categoryTagName, m)
                             //                                       ) != null ?
                             //    // get the category order
                             //               int.Parse(samplesAPI.GetSampleTagValue( allSamples.FirstOrDefault(
                             //                                   s => samplesAPI.HasTag(s, categoryOrderTagName)
                             //                                        &&  samplesAPI.HasTagValue(s, categoryTagName, m)
                             //                                       ), categoryOrderTagName, int.MaxValue.ToString()))
                             //                                           : int.MaxValue)

                             //.OrderBy(m => allCategories.Any(c => c.Name == m) ? )
                             .ToList();

    var categoryHeight = 80;
    var categoryItemHeight = 18;

    var categoryRowsCount = 3;

    var totalCategoriesHeight = sampleCategories.Count() * categoryHeight;
    var totalLinksHeight = 0;

    foreach (var sampleGroupName in sampleCategories)
    {
        var samples = samplesWithCategories.Where(s => s.Tags.First(t => t.Name == categoryTagName).Values.Contains(sampleGroupName));

        totalLinksHeight += samples.Count() * categoryItemHeight;
    }

    var totalHeight = totalCategoriesHeight + totalLinksHeight;
    var rowHeight = totalHeight / categoryRowsCount;

    var currentRowHeight = 0;
}

<div class="m-sample-list-cnt">
    @{

        foreach (var sampleGroupName in sampleCategories)
        {
            dynamic categoryModel = new System.Dynamic.ExpandoObject();

            categoryModel.Samples = SubPointSolutions.DocsBuildTools.Data.SampleReadAPI.GetSamplesWithTag(allSamples, categoryTagName, sampleGroupName)
                                                                                       .Where(s => s.IsMethod == true)
                                                                                       .ToList();
            categoryModel.CategoryName = sampleGroupName;

            ViewBag.SamplesModel = categoryModel;

            @Html.Partial(SConfig.GetThemedTemplate("Components/_Docs.SampleListCategory.cshtml"));
        }
    }

</div>
