@{
    var categoryTagName = "Category";


    var allSamples = ViewBag.SamplesModel.Samples as List<SubPointSolutions.DocsBuildTools.Data.DocSample>;
    var samplesWithCategories = SConfig.AllSamples;

    var sampleCategories = SubPointSolutions.DocsBuildTools.Data.SampleReadAPI.GetSampleCategories(allSamples);

    var categoryHeight = 80;
    var categoryItemHeight = 18;

    var categoryRowsCount = 4;

    var totalCategoriesHeight = sampleCategories.Count() * categoryHeight;
    var totalLinksHeight = 0;

    foreach (var sampleGroupName in sampleCategories)
    {
        var samples = allSamples.Where(s => s.Tags.First(t => t.Name == categoryTagName).Values.Contains(sampleGroupName));

        totalLinksHeight += samples.Count() * categoryItemHeight;
    }

    var totalHeight = totalCategoriesHeight + totalLinksHeight;
    var rowHeight = totalHeight / categoryRowsCount;

    var currentRowHeight = 0;
}

<h3>@ViewBag.SamplesModel.CategoryName</h3>

<div class="panel-body">

    @Html.Raw("<div class='col-sm-3 col-md-3'>")

    @foreach (var sampleGroupName in sampleCategories)
    {
        currentRowHeight += categoryHeight;

        if (currentRowHeight > rowHeight && !(sampleCategories.IndexOf(sampleGroupName) == 0))
        {
            currentRowHeight = 0;

            @Html.Raw("</div>")
            @Html.Raw("<div class='col-sm-3 col-md-3'>")
        }

        var samples = samplesWithCategories.Where(s => {

            return s.IsMethod == true 
                        && s.Tags.Any(t => t.Name == categoryTagName)
                        && s.Tags.First(t => t.Name == categoryTagName).Values.Contains(sampleGroupName);
        });

        if (!samples.Any())
        {
            continue;
        }

        <div class="panel panel-default ">
            <div class="panel-heading">
                @sampleGroupName
            </div>
            <div class="panel-body">

                <ul>
                    @foreach (var sample in samples)
                    {
                        currentRowHeight += categoryItemHeight;

                        var definitionClassName = sample.ClassName
                                                        .Replace("Tests", string.Empty)
                                                        .Replace("Test", string.Empty);

                        var isStandardTag = sample.Tags.FirstOrDefault(t => t.Name == "isStandard");

                        if (isStandardTag == null)
                        {
                            throw new Exception(string.Format("Cannot find [isStandard] tag for sample:[{1}] in file:[{0}", sample.SourceFileName, sample.MethodName));
                        }

                        var isStandardSample = isStandardTag.Values.Contains(true.ToString());

                        var definitionUrl = "/spmeta2/reference/sp-foundation-definitions/{0}";

                        if (isStandardSample)
                        {
                            definitionUrl = "/spmeta2/reference/sp-standard-definitions/{0}";
                        }

                        var definitionPageUrl = string.Format(definitionUrl, definitionClassName).ToLower();
                        var isHidden = SubPointSolutions.DocsBuildTools.Data.SampleReadAPI.HasTag(sample, "Hidden");
                        <li>
                            @if (isHidden)
                            {
                                @(sample.Title)
                            }
                            else
                            {
                                <a href="@(definitionPageUrl + "?#" +  SubPointSolutions.DocsBuildTools.Data.SampleReadAPI.GetSafeAnchor(sample.Title))">
                                    @(sample.Title)
                                </a>
                            }
                        </li>
                    }
                </ul>
                
            </div>
        </div>
    }
    

    @Html.Raw("</div>")
</div>


