<html><head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Custom Definitions</title>

    <link href="/content/bootstrap.min.css" rel="stylesheet">

    <link href="/content/syntaxhighlighter/shcore.css" rel="stylesheet">
    <link href="/content/syntaxhighlighter/shcoredefault.css" rel="stylesheet">

    <link href="/content/s.docs.default.css" rel="stylesheet">
</head>
<body>


    

<style>
    .font-17 {
        font-size: 17px;
    }
</style>



<div class="navbar navbar-inverse navbar-fixed-top">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">
                Documentation
                    <span class="glyphicon glyphicon-chevron-right">
            </span></a>
        </div>

            <ul class="nav navbar-nav">
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle font-17" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">
                        SPMeta2<span class="caret"></span>
                    </a>
                    <ul class="dropdown-menu">
                        <li><a href="/spmeta2-ex">SPMeta2 VS Extensions</a></li>
                        <li><a href="/spmeta2-spec">SPMeta2 Spec</a></li>
                        <li><a href="/spmeta2-nuget">SPMeta2 NuGet</a></li>
                        <li role="separator" class="divider"></li>
                        <li><a href="/resp">reSP</a></li>
                    </ul>
                </li>
            </ul>

    </div>
</div>

<div class="container body-content sd-body-content">

    <div class="row">
        



<div class="sub-nav">



    <h2>
            <a href="/spmeta2/extensibility/index.html">
                Extensibility
            </a>
        
    </h2>

    <ul>
            <li>
                <a class="" href="/spmeta2/getting-started/index.html">
                    Getting Started
                </a>
            </li>
            <li>
                <a class="" href="/spmeta2/reference/index.html">
                    Reference
                </a>
            </li>
            <li>
                <a class="active" href="/spmeta2/extensibility/index.html">
                    Extensibility
                </a>
            </li>
            <li>
                <a class="" href="/spmeta2/samples/index.html">
                    Samples
                </a>
            </li>
            <li>
                <a class="" href="/spmeta2/kb/index.html">
                    KB
                </a>
            </li>

    </ul>
</div>
    </div>

    <div class="row">

        <div class="col-lg-8 col-md-8 col-sm-8">
            <p>This article provides basics on creating a custom definion and model handler for SPMeta2 library.</p>
<p>Before you begin, make sure you are familiar with the following concepts:</p>
<ul>
<li><a href="http://docs.subpointsolutions.com/spmeta2/basics/" target="_blank">SPMeta2 basics</a></li>
<li><a href="http://docs.subpointsolutions.com/spmeta2/definitions/" target="_blank">SPMeta2 definitions</a></li>
</ul>
<h3>Overview</h3>
<p>SPMeta2 can be extended with custom definition and model handler, so that you can plug in your own provision logic.</p>
<p>Here is a big puctire on how SPMeta2 provision walks through the web model with lists and list views.</p>
<p>&lt;img src='http://g.gravizo.com/g?</p>
<p>@startuml;</p>
<p>"web definition" -&gt; "web definition": lookup handler;
"web definition" -&gt; "web definition": DeployModel();
"web definition" -&gt; "web definition": lookup children models;
"web definition" -&gt; "list definition": WithResolvingModelHost(), get web instance;</p>
<p>"list definition" -&gt; "list definition": lookup handler;
"list definition" -&gt; "list definition": DeployModel();
"list definition" -&gt; "list definition": lookup children models;
"list definition" -&gt; "list view definition": WithResolvingModelHost(), get list instance;</p>
<p>"list view definition" -&gt; "list view definition": lookup handler;
"list view definition" -&gt; "list view definition": DeployModel();
"list view definition" -&gt; "list definition": back;</p>
<p>"list definition" -&gt; "web definition": back;</p>
<p>@enduml
'&gt;</p>
<p>At the end, SPMeta2 provision service walks through the model tree resolving correct model handler and calling a pair of DeployModel() and WithResolvingModelHost() methods.</p>
<p>All model handlers must inherit ModelHandlerBase class and implement the following methods:</p>
<ul>
<li>DeployModel(object modelHost, DefinitionBase model) method</li>
<li>TargetType property</li>
<li>Optionally, WithResolvingModelHost(ModelHostResolveContext context) method</li>
</ul>
<p>DeployModel() methods must also raise a pair of OnProvisioning / OnProvisioned event, so that it would be possible to get access to the raw SharePoint object during the provision.</p>
<p>Let's have a closer look and create a simple custom definition with model handler.</p>
<h3>Scenario</h3>
<p>We need to have a custom defintion to change existing web title and description.</p>
<h4>Creating definition</h4>
<p>All definition should meet the following criterias:</p>
<ul>
<li>Inherit DefinitionBase class</li>
<li>Have [Serializable] attribute</li>
</ul>
<p>Here is how a custom ChangeWebTitleAndDescriptionDefinition might look like:</p>
<p>[CLASS.ChangeWebTitleAndDescriptionDefinition]</p>
<h4>Creating model handlers</h4>
<p>The next step would be creating a custom model handler:</p>
<p>[CLASS.ChangeWebTitleAndDescriptionModelHandler]</p>
<h4>Registering model handler</h4>
<p>One you created a custom model handler, we need to let SPMeta2 know about it.</p>
<p>Provision service have the following methods to address this:</p>
<ul>
<li>RegisterModelHandler(ModelHandlerBase modelHandlerType)</li>
<li>RegisterModelHandlers(Assembly assembly)</li>
</ul>
<p>Let's use the first one and register our handler:</p>
<p>[TEST.RegisterCustomModelHandler]</p>
<h4>Custom syntax</h4>
<p>There is a separate article on how to create a <a href="http://docs.subpointsolutions.com/spmeta2/extensibility/writing-custom-syntax/" target="_blank">custom syntax extensions</a>, so let's just improve our provision and add custom syntax for ChangeWebTitleAndDescriptionDefinition:</p>
<p>[CLASS.ChangeWebTitleAndDescriptionDefinitionSyntax]</p>
<p>Now we can re-write provision with a better syntax:</p>
<p>[TEST.RegisterCustomModelHandlerWithSyntax]</p>
<h4>Handling events</h4>
<p>We expect that our model handler would raise OnProvisioning / OnProvisioned while pushing definition to SharePoint. Let's attache to these events and see how it goes.</p>
<p>[TEST.RegisterCustomModelHandlerWithEvents]</p>


        </div>

        <div class="col-lg-4 col-md-4 col-sm-4">
            

<div class="sd-sidebar panel panel-default hidden-print hidden-xs hidden-sm affix1">
    <ul class="nav ">
                        <li class="root">

                            <a href="/spmeta2/extensibility/index.html">
                                Extensibility
                            </a>
                        </li>
                        <li class="root active">

                            <a href="/spmeta2/extensibility/custom-definition.html">
                                Custom Definitions
                            </a>
                        </li>
                        <li class="root">

                            <a href="/spmeta2/extensibility/custom-logging.html">
                                Custom Logging
                            </a>
                        </li>
                        <li class="root">

                            <a href="/spmeta2/extensibility/custom-syntax.html">
                                Custom syntax
                            </a>
                        </li>

    </ul>



</div>
        </div>

    </div>
</div>

<div class="container sps-footer">
    <div class="row">
        <hr>
        <footer>
            <p>Copyright Â© SubPoint Solutions 2016. Built with "Bootstrap" theme.</p>
        </footer>
    </div>
</div>


    <script src="/scripts/jquery-1.9.1.min.js"></script>
    <script src="/scripts/bootstrap.js"></script>

    <script src="/scripts/syntaxhighlighter/shcore.js"></script>
    <script src="/scripts/syntaxhighlighter/shbrushcsharp.js"></script>
    <script src="/scripts/syntaxhighlighter/shbrushxml.js"></script>


    

    


    <script>

        jQuery(document).ready(function () {

            jQuery('code.language-cs')
                .addClass('brush: csharp;');

            jQuery('code.language-xml')
                .addClass('brush: xml;');

            SyntaxHighlighter.defaults['quick-code'] = false;
            SyntaxHighlighter.config.tagName = 'code';
            SyntaxHighlighter.all();
        });

    </script>



</body></html>